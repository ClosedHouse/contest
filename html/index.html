<html>
<head>
<title>OpenHouse 2015</title>
<script src="./jquery-2.1.3.min.js"></script>
<script src="./jquery.terminal-0.8.8.min.js"></script>
<link href="./jquery.terminal.css" rel="stylesheet"/>
<link href="./index.css" rel="stylesheet"/>
<script>
(function($) {
    $.fn.tilda = function(eval, options) {
        if ($('body').data('tilda')) {
            return $('body').data('tilda').terminal;
        }
        this.addClass('tilda');
        options = options || {};
        eval = eval || function(command, term) {
            term.echo("you don't set eval for tilda");
        };
        var settings = {
            prompt: 'command> ',
            name: 'tilda',
            height: 100,
            enabled: false,
            greetings: 'use \"help\" command for ... help',
            keypress: function(e) {
                if (e.which == 96) {
                    return false;
                }
            }
        };
        if (options) {
            $.extend(settings, options);
        }
        this.append('<div class="td"></div>');
        var self = this;
        self.terminal = this.find('.td').terminal(eval, settings);
        var focus = false;
        $(document.documentElement).keypress(function(e) {
            if (e.which == 96) {
                self.slideToggle('fast');
                self.terminal.focus(focus = !focus);
                self.terminal.attr({
                    scrollTop: self.terminal.attr("scrollHeight")
                });
            }
        });
        $('body').data('tilda', this);
        this.hide();
        return self;
    };
})(jQuery);
//--------------------------------------------------------------------------
var help_used = 0;
var shell_locked = 1;

jQuery(document).ready(function($) {
    $('#tilda').tilda(function(command, terminal) {
	    if (shell_locked == 1) {
		terminal.echo('Shell is now locked.');
		return;
	    }
	    	
	    if (command == "help") {
	    	if (help_used) {
			terminal.echo('No help avaiable now');
			return;
		}
		//help_used = 1;
		terminal.echo('Hide this terminal to see whole manual page.');
		$('body').css('background-color', 'black');
		$("#scene2-bg").hide();
		$("#scene2").hide();
		$("#scene2-1").hide();
		$("#scene2-2").hide();
		$("#scene3").show();
		return;
	    }

	terminal.echo('Unknown command my master');
    });

$('#scene2').hide();
$('#scene2-1').hide();
$('#scene2-2').hide();
$('#scene3').hide();
$('#scene2-bg').hide();

function switch_scene(src_scene, dst_scene, delay) {
	$(src_scene).delay(delay).fadeOut(2000, function() {
		$(dst_scene).fadeIn(2000, function() {});
	});
}

$( '#enter' ).click(function() {
	$('#scene1').fadeOut(2000, function() {});
	$('#scene2-bg').delay(2000).fadeIn(2000, function() { 
		$('#scene2').fadeIn(2000, function() { switch_scene('#scene2', '#scene2-1', 0) });
		switch_scene("#scene2-1", "#scene2-2", 0);
		shell_locked = 0;
	});
})

})

</script>
</head>
<body>
<div id="tilda"></div>

            <div id="scene1"><div id="enter">ENTER the GAME</div></div>
            <div id="scene2"></div>
            <div id="scene2-1">Welcome</br></br></br></div>
            <div id="scene2-2">The GAME</div>
            <div id="scene2-bg"></div>
            <div id="scene3">
                <p>Your VPS server was hacked by a well known hacker organisation. They call themselves pumkin squad and they fight for freedom of their pumpkins. Pumpkins and hacking are essential for theirs lives.</p>
                <p>The server has been disconnected from the network after the incident.
As a security expert, you have received the machine for investigation. </p>
                <p>
                This game consists of different levels. In each of the levels you will the access code to the next level. Codes are in the form OH15_234567.</p>

                <p>
                First of all, you need to connect to your hacked server. Open real (not that dummy copy in browser) and use:</p>
                <pre>
$ ssh root@hacked
                </pre>
                <p>
                Once you find the access code, switch back to the browser, press ~ key and type 'jump' followed by the code.
                </p>
            </div>

            <div id="scene4">
                    Probably, there is a back-door. You might want to check your filesystem first. One of the ways to create a back-door is leaving a special binary that is owned by root, but when it is executed by any user, it runs under the 'root' super-user.

                    #english: As an administrator?
                </div>
                <div id="hint41">
                    A binary might
                </div>
                <div id="hint42">
                    <pre>
                        find /usr/bin -perm /4000
                    </pre>
                    Find the back-door binary and delete it. Do not damage the system. Watch closely the access codes.
                </div>
                <div id="scene5">
                    Check if the file is properly deleted.
                </div>
                <div id="hint51">
                    Something is recovering the back-door! It could be one of the running processes. You might need to monitor what happens on the system and identify the process that recovers the file after deletion. The systemtap tool might be handy. Get rid of the program!
                </div>
                <div id="hint52">
                    <pre>
                        stap ...
                    </pre>
                </div>
                <div id="scene6">
                    Delete the back-door now and check if the file has been properly deleted once you got rid of the malicious program (killed the process and deleted the executable).
                </div>
                <div id="hint61">
                    <p>
                        Something is recovering the malicious program again and it spawns again even when it is killed!
                    </p>
                    <p>
                        Look if there is anything (running) that might launch the malicious program after it is being deleted. Systemtap might come handy again.
                    </p>
                </div>
                <div id="hint62">
                    <p>
                        There is another process that installs the malicious program and runs it. It also modified the kernel so that it is not visible in the process list.
                    </p>
                </div>
                <div id="hint63">
                    <p>
                        <pre>stap ...</pre>
                    </p>
                </div>
</body>
